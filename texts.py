TEXTS = {
    'ru': {
        'welcome': 'Добро пожаловать!',
        'captcha': 'Для входа решите каптчу: {code}\nВведите 5 цифр:',
        'captcha_failed': 'Неверная каптча! Попробуйте снова:',
        'language_selected': 'Язык установлен: Русский',
        'main_menu': (
            "👤 Имя: {name}\n"
            "📛 Юзернейм: @{username}\n"
            "🛒 Покупок: {purchases}\n"
            "🎯 Скидка: {discount}%\n"
            "💰 Баланс: {balance}$"
        ),
        'select_city': 'Выберите город:',
        'select_category': 'Выберите категорию:',
        'select_district': 'Выберите район:',
        'select_delivery': 'Выберите тип доставки:',
        'order_summary': (
            "Информация о заказе:\n"
            "📦 Товар: {product}\n"
            "💵 Стоимость: {price}$\n"
            "🏙 Район: {district}\n"
            "🚚 Тип доставки: {delivery_type}\n\n"
            "Всё верно?"
        ),
        'select_crypto': 'Выберите криптовалюту для оплаты:',
        'payment_instructions': (
            "Оплатите {amount} {currency} по адресу:\n"
            "`{payment_address}`\n\n"
            "Отсканируйте QR-код для оплаты:\n"
            "После оплаты товар будет выслан автоматически."
        ),
        'payment_timeout': 'Время оплата истекло. Заказ отменен.',
        'payment_success': 'Оплата получена! Ваш товар:\n\n{product_image}',
        'balance': 'Ваш баланс: {balance}$',
        'balance_add': 'Введите сумму для пополнения баланса в $:',
        'balance_add_success': 'Баланс пополнен на {amount}$. Текущий баланс: {balance}$',
        'support': 'По всем вопросам обращайтесь к @support_username',
        'bonuses': 'Бонусная система:\n- За каждую 5-ю покупку скидка 10%\n- Пригласи друга и получи 50$ на баланс',
        'rules': 'Правила:\n1. Не сообщайте никому данные о заказе\n2. Оплата только в течение 60 минут\n3. При нарушении правил - бан',
        'reviews': 'Наши отзывы: @reviews_channel',
        'error': 'Произошла ошибка. Попробуйте позже.',
        'ban_message': 'Вы забанены на 24 часа из-за 3 неудачных попыток оплаты.',
        'back': '⬅️ Назад',
        'main_menu_button': '🏠 Главное меню',
        'last_order': 'Информация о последнем заказе',
        'no_orders': 'У вас еще не было заказов'
    },
    'en': {
        'welcome': 'Welcome!',
        'captcha': 'To enter, solve the captcha: {code}\nEnter 5 digits:',
        'captcha_failed': 'Invalid captcha! Try again:',
        'language_selected': 'Language set: English',
        'main_menu': (
            "👤 Name: {name}\n"
            "📛 Username: @{username}\n"
            "🛒 Purchases: {purchases}\n"
            "🎯 Discount: {discount}%\n"
            "💰 Balance: {balance}$"
        ),
        'select_city': 'Select city:',
        'select_category': 'Select category:',
        'select_district': 'Select district:',
        'select_delivery': 'Select delivery type:',
        'order_summary': (
            "Order information:\n"
            "📦 Product: {product}\n"
            "💵 Price: {price}$\n"
            "🏙 District: {district}\n"
            "🚚 Delivery type: {delivery_type}\n\n"
            "Is everything correct?"
        ),
        'select_crypto': 'Select cryptocurrency for payment:',
        'payment_instructions': (
            "Pay {amount} {currency} to address:\n"
            "`{payment_address}`\n\n"
            "Or scan QR-code:\n"
            "After payment, the product will be sent automatically."
        ),
        'payment_timeout': 'Payment time has expired. Order canceled.',
        'payment_success': 'Payment received! Your product:\n\n{product_image}',
        'balance': 'Your balance: {balance}$',
        'balance_add': 'Enter the amount to top up your balance in $:',
        'balance_add_success': 'Balance topped up by {amount}$. Current balance: {balance}$',
        'support': 'For all questions contact @support_username',
        'bonuses': 'Bonus system:\n- 10% discount for every 5th purchase\n- Invite a friend and get 50$ on your balance',
        'rules': 'Rules:\n1. Do not share order information with anyone\n2. Payment only within 60 minutes\n3. Ban for breaking the rules',
        'reviews': 'Our reviews: @reviews_channel',
        'error': 'An error occurred. Please try again later.',
        'ban_message': 'You are banned for 24 hours due to 3 failed payment attempts.',
        'back': '⬅️ Back',
        'main_menu_button': '🏠 Main Menu',
        'last_order': 'Information about last order',
        'no_orders': 'You have no orders yet'
    },
    'ka': {
        'welcome': 'კეთილი იყოს თქვენი მობრძანება!',
        'captcha': 'შესასვლელად გადაწყვიტეთ captcha: {code}\nშეიყვანეთ 5 ციფრი:',
        'captcha_failed': 'არასწორი captcha! სცადეთ თავიდან:',
        'language_selected': 'ენა დაყენებულია: ქართული',
        'main_menu': (
            "👤 სახელი: {name}\n"
            "📛 მომხმარებლის სახელი: @{username}\n"
            "🛒 ყიდვები: {purchases}\n"
            "🎯 ფასდაკლება: {discount}%\n"
            "💰 ბალანსი: {balance}$"
        ),
        'select_city': 'აირჩიეთ ქალაქი:',
        'select_category': 'აირჩიეთ კატეგორია:',
        'select_district': 'აირჩიეთ რაიონი:',
        'select_delivery': 'აირჩიეთ მიწოდების ტიპი:',
        'order_summary': (
            "შეკვეთის ინფორმაცია:\n"
            "📦 პროდუქტი: {product}\n"
            "💵 ფასი: {price}$\n"
            "🏙 რაიონი: {district}\n"
            "🚚 მიწოდების ტიპი: {delivery_type}\n\n"
            "ყველაფერი სწორია?"
        ),
        'select_crypto': 'აირჩიეთ კრიპტოვალუტა გადასახდელად:',
        'payment_instructions': (
            "გადაიხადეთ {amount} {currency} მისამართზე:\n"
            "`{payment_address}`\n\n"
            "ან სკანირება QR-კოდი:\n"
            "გადახდის შემდეგ პროდუქტი გამოგეგზავნებათ ავტომატურად."
        ),
        'payment_timeout': 'გადახდის დრო ამოიწურა. შეკვეთა გაუქმებულია.',
        'payment_success': 'გადახდა მიღებულია! თქვენი პროდუქტი:\n\n{product_image}',
        'balance': 'თქვენი ბალანსი: {balance}$',
        'balance_add': 'შეიყვანეთ ბალანსის შევსების რაოდენობა $:',
        'balance_add_success': 'ბალანსი შეივსო {amount}$-ით. მიმდინარე ბალანსი: {balance}$',
        'support': 'ყველა კითხვისთვის დაუკავშირდით @support_username',
        'bonuses': 'ბონუს სისტემა:\n- ყოველ მე-5 ყიდვაზე 10% ფასდაკლება\n- მოიწვიე მეგობარი და მიიღე 50$ ბალანსზე',
        'rules': 'წესები:\n1. არავის არ შეახოთ შეკვეთის ინფორმაცია\n2. გადახდა მხოლოდ 60 წუთის განმავლობაში\n3. წესების დარღვევაზე - ბანი',
        'reviews': 'ჩვენი მიმოხილვები: @reviews_channel',
        'error': 'მოხდა შეცდომა. სცადეთ მოგვიანებით.',
        'ban_message': '3 წარუმატებელი გადახდის მცდელობის გამო თქვენ დაბლოკილი ხართ 24 საათის განმავლობაში.',
        'back': '⬅️ უკან',
        'main_menu_button': '🏠 მთავარი მენიუ',
        'last_order': 'ბოლო შეკვეთის ინფორმაცია',
        'no_orders': 'ჯერ არ გაქვთ შეკვეთები'
    }
}

# Функция для получения текста на нужном языке
def get_text(lang, key, **kwargs):
    if lang not in TEXTS:
        lang = 'ru'
    if key not in TEXTS[lang]:
        return f"Текст не найден: {key}"
    
    text = TEXTS[lang][key]
    try:
        if kwargs:
            text = text.format(**kwargs)
        return text
    except KeyError as e:
        logger.error(f"Ошибка форматирования текста: {e}, ключ: {key}, аргументы: {kwargs}")
        return text
